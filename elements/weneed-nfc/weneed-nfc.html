<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="weneed-nfc">
  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'weneed-nfc',

        properties: {
          faking: {
            type: Boolean,
            value: false,
            notify: true
          }
        },

        created: function() {
          this.randomData = ['Washing powder', 'Dishwasher tabs', 'Toilet paper', 'Milk'];
        },

        attached: function() {
          if (!navigator.nfc) {
            this.faking = true;
            return;
          }

          navigator.nfc.requestAdapter().then(function(adapter) {
            adapter.watch({}, function(message) {
              if (message[0].kind !== 'json') {
                console.warn('Malformed NFC tag');
                return;
              }
              var name = message[0].data.name;
              this.onItemReceived(name); 
            }).bind(this);
          }).bind(this);
        },

        onItemReceived: function(name) {
          if (!name || this.faking) {
             name = this.randomData[Math.floor(Math.random() * this.randomData.length)];
          }
          var store = this.$$('item-store:nth-of-type(1)');
          store.addItem(name);
        }
      });
    })();
  </script>

</dom-module>