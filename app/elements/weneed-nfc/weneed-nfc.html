<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="weneed-nfc">
  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'weneed-nfc',

        properties: {
    		  inFakeMode: {
    			  type: Boolean,
    			  value: false
    		  },
          store: {
            type: Object,
            value: null
          }
        },

        created: function() {
          this.randomData = ["Washing powder", "Dishwasher tabs", "Toilet paper", "Milk"];
          
          if (!navigator.nfc) {
            this.inFakeMode = true;
            return;
          }
            
          navigator.nfc.requestAdapter((adapter) => {
            adapter.watch({}, (message, url) => {
              if (message[0].kind !== "json") {
                console.warn("Malformed NFC tag");
                return;
              }
              let name = message[0].data['name'];
              this.onItemReceived(name); 
            });
          });
        },

        onItemReceived: function(name) {
          if (!name || this.inFakeMode)
             name = this.randomData[Math.floor(Math.random() * this.randomData.length)];
          let store = this.$$('item-store:nth-of-type(1)');
          store.addItem(name);
        }
      });
    })();
  </script>

</dom-module>